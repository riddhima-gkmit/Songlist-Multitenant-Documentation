{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Project Overview","text":""},{"location":"#songlist-backend","title":"SongList Backend","text":"<p>Multi-tenant music content management API built with Django REST Framework. It lets organizations (tenants) manage music libraries, playlists, song requests, and subscriptions with strict data isolation and role-based access.</p>"},{"location":"#project-overview","title":"Project overview","text":"<p>SongList is the backend for a SaaS platform that serves many independent organizations (tenants), such as venues, labels, and event companies. Each tenant can:</p> <ul> <li>Maintain its own music catalog and playlists</li> <li>Accept and manage live song requests</li> <li>Offer subscription-based access for listeners</li> </ul> <p>All of this runs on a shared platform that enforces tenant isolation and central administration.</p>"},{"location":"#problem-statement","title":"Problem statement","text":"<p>Most existing music request or playlist systems are built for a single organization. This leads to several issues when you try to scale to many tenants:</p> <ul> <li>Hard to onboard and manage many independent tenants in one system</li> <li>Weak or manual data isolation between organizations</li> <li>No clear separation of responsibilities between listeners, tenant admins, and platform admins</li> <li>Inconsistent or ad-hoc APIs for mobile/web clients</li> </ul> <p>SongList aims to solve these issues with a purpose-built multi-tenant backend.</p>"},{"location":"#proposed-solution-and-objectives","title":"Proposed solution and objectives","text":"<p>SongList provides:</p> <ul> <li>A multi-tenant architecture with clear separation between GLOBAL and TENANT-level data</li> <li>Role-based access control for listeners, tenant admins, and platform super admins</li> <li>Consistent, well-documented REST APIs for mobile and web clients</li> <li>Extensible modules for songs, playlists, requests, billing, and operational workflows</li> </ul> <p>The main objectives are to:</p> <ul> <li>Make onboarding new tenants simple and predictable</li> <li>Guarantee strong tenant isolation and auditable access patterns</li> <li>Keep the API surface consistent, discoverable, and easy to integrate with</li> <li>Leave room for future features like analytics, recommendations, and third-party integrations</li> </ul>"},{"location":"#functional-documentation","title":"Functional documentation","text":"<p>The functional documentation focuses on user roles, capabilities, and end-to-end journeys:</p> <ul> <li>LISTENER: Interacts with playlists and song requests.</li> <li>ADMIN: Manages a single tenant\u2019s catalogs, playlists, and operational workflows.</li> <li>SUPER_ADMIN: Manages the overall platform, tenants, and global settings.</li> </ul> <p>See Functional Documentation for full details on behavior, edge cases, and flows.</p>"},{"location":"#technical-documentation","title":"Technical documentation","text":"Topic Description API Design REST endpoints, data scope, error handling Authentication OTP, JWT, permissions, deletion &amp; restoration Core Modules Users, tenants, songs, playlists, and more Tech Stack Django, PostgreSQL, Redis, Celery, Razorpay Schema Design Models, relationships, constraints Developer Setup Local run, env vars, migrations, seeding Conventions Tenant isolation, GLOBAL vs TENANT, guardrails"},{"location":"functional-docs/","title":"Functional Documentation","text":""},{"location":"functional-docs/#functional-documentation","title":"Functional Documentation","text":"<p>This document describes what the SongList Backend does at a business level: roles, features, user journeys, and system behavior. It does not describe implementation or list endpoints.</p> <p>On this page</p> Section Description What the System Does High-level purpose Roles LISTENER, ADMIN, SUPER_ADMIN Core Features Auth, tenants, songs, playlists, etc. User Journeys LISTENER, ADMIN, SUPER_ADMIN flows System Behavior Isolation, deletion, safeguards Summary Recap and pointers"},{"location":"functional-docs/#what-the-system-does","title":"What the System Does","text":"<p>SongList Backend is a multi-tenant music content management system. Organizations (tenants) use it to:</p> <ul> <li>Run a music library and playlist experience for their users</li> <li>Manage users, songs, and song requests within each tenant</li> <li>Offer premium subscriptions per tenant</li> <li>Keep each tenant\u2019s data fully isolated from others</li> </ul> <p>Platform operators:</p> <ul> <li>Manage tenants</li> <li>Manage global song catalog</li> <li>Manage genres</li> </ul> <p>Tenant admins:</p> <ul> <li>Manage their organization's users</li> <li>Manage songs and playlists</li> <li>Manage subscriptions</li> </ul>"},{"location":"functional-docs/#roles","title":"Roles","text":""},{"location":"functional-docs/#listener","title":"LISTENER","text":"<p>Regular tenant users.</p> <p>Can:</p> <ul> <li>Register (within a tenant), verify email, log in, manage own profile, self-delete</li> <li>View approved songs in their tenant</li> <li>Create and manage own playlists; add/remove songs in own playlists</li> <li>Submit song requests</li> </ul> <p>Cannot:</p> <ul> <li>Access songs directly (must use tenant songs)</li> <li>Access genres</li> <li>Approve or fulfill requests</li> <li>Manage other users</li> <li>Access other users' playlists or tenant admin features</li> </ul>"},{"location":"functional-docs/#admin","title":"ADMIN","text":"<p>Tenant administrators.</p> <p>Can:</p> <ul> <li>Everything a LISTENER can within the tenant, plus:</li> <li>Create LISTENER users</li> <li>View/update/delete tenant users (except self and other admins)</li> <li>View/update/delete any tenant playlist and manage playlist songs</li> <li>Link/unlink songs to the tenant</li> <li>Approve/reject/fulfill song requests</li> <li>Create payment links</li> <li>View tenant subscription and tenant details</li> </ul> <p>Cannot:</p> <ul> <li>Delete themselves</li> <li>Delete other admins or super admins</li> <li>Access other tenants' data</li> <li>Manage tenants or platform-level config</li> <li>Manage GLOBAL songs or genres</li> <li>View platform-wide subscriptions/payments</li> </ul>"},{"location":"functional-docs/#super_admin","title":"SUPER_ADMIN","text":"<p>Platform administrators.</p> <p>Can:</p> <ul> <li>Log in without a tenant</li> <li>Manage tenants (create, update, activate, deactivate, delete when empty)</li> <li>Manage GLOBAL songs and genres</li> <li>Create ADMIN users for any tenant</li> <li>View user counts and all admins</li> <li>View all subscriptions and payments</li> </ul> <p>Cannot:</p> <ul> <li>Access any tenant-specific data (users, playlists, song requests, tenant-song links, TENANT songs)</li> <li>Access PII beyond admin listing</li> </ul>"},{"location":"functional-docs/#core-features","title":"Core Features","text":""},{"location":"functional-docs/#authentication-and-roles","title":"Authentication and Roles","text":"<p>Registration:</p> <ul> <li>LISTENER only</li> <li>Tenant-scoped</li> <li>ADMIN and SUPER_ADMIN are created by others, not self-registration</li> </ul> <p>Email verification:</p> <ul> <li>Required before first login</li> <li>OTP-based</li> </ul> <p>Login:</p> <ul> <li>Two-step OTP (request OTP \u2192 verify OTP)</li> <li>JWT access and refresh tokens issued</li> <li>SUPER_ADMIN uses a separate, tenant-free login</li> </ul> <p>Password reset:</p> <ul> <li>OTP-based</li> <li>Tenant-scoped for tenant users</li> </ul> <p>Password change:</p> <ul> <li>Blacklists all existing access and refresh tokens</li> <li>Forces re-login everywhere</li> </ul> <p>Logout:</p> <ul> <li>Blacklists refresh token</li> <li>Denylists access token</li> </ul>"},{"location":"functional-docs/#tenants","title":"Tenants","text":"<p>Purpose:</p> <ul> <li>Represent organizations</li> <li>All tenant users and tenant-specific data belong to a tenant</li> </ul> <p>Management:</p> <ul> <li>SUPER_ADMIN creates, updates, activates, deactivates, and deletes tenants</li> <li>Tenant cannot be deleted if it has any active users</li> </ul> <p>Visibility:</p> <ul> <li>ADMIN can view their tenant's details only (read-only)</li> <li>LISTENER has no tenant management access</li> </ul>"},{"location":"functional-docs/#songs-and-playlists","title":"Songs and Playlists","text":"<p>Songs:</p> <ul> <li>Two scopes: GLOBAL and TENANT</li> <li>GLOBAL songs are platform-wide, managed by SUPER_ADMIN</li> <li>TENANT songs are per-tenant, managed by tenant ADMIN</li> <li>LISTENER never access the song catalog directly</li> <li>LISTENER see only tenant songs (links between tenants and songs) that are approved for their tenant</li> </ul> <p>Tenant-song links:</p> <ul> <li>Admins link songs to their tenant</li> <li>Admins mark links as approved or not</li> <li>LISTENER see only approved tenant songs</li> </ul> <p>Playlists:</p> <ul> <li>User-owned</li> <li>LISTENER manage only their own</li> <li>ADMIN can manage all playlists in their tenant (create on behalf of users, add/remove songs, etc.)</li> <li>Only approved tenant songs can be added</li> <li>SUPER_ADMIN has no playlist access</li> </ul>"},{"location":"functional-docs/#song-requests","title":"Song Requests","text":"<p>Purpose:</p> <ul> <li>Users request songs</li> <li>Admins review and fulfill (approve, reject, or fulfill by linking/creating a song)</li> </ul> <p>Flow:</p> <ul> <li>LISTENER create and manage their own requests</li> <li>ADMIN view all tenant requests</li> <li>ADMIN create requests for any tenant user</li> <li>ADMIN approve/reject/fulfill requests</li> <li>SUPER_ADMIN has no access</li> </ul> <p>States:</p> <ul> <li>PENDING \u2192 APPROVED, REJECTED, or FULFILLED</li> </ul>"},{"location":"functional-docs/#genres","title":"Genres","text":"<p>Purpose:</p> <ul> <li>Categorize songs</li> <li>Platform-wide, shared by all tenants</li> </ul> <p>Access:</p> <ul> <li>SUPER_ADMIN: full CRUD</li> <li>ADMIN: read-only</li> <li>LISTENER: no access</li> </ul> <p>Rule:</p> <ul> <li>A genre cannot be deleted if any non\u2013soft-deleted song is linked to it</li> </ul>"},{"location":"functional-docs/#payments-and-subscriptions","title":"Payments and Subscriptions","text":"<p>Purpose:</p> <ul> <li>Per-tenant premium (e.g. lifetime) subscription via Razorpay</li> </ul> <p>Creation:</p> <ul> <li>ADMIN create payment links for their tenant</li> <li>SUPER_ADMIN does not create payment links</li> </ul> <p>Status:</p> <ul> <li>ADMIN can view tenant subscription status</li> <li>SUPER_ADMIN can view tenant subscription status</li> <li>SUPER_ADMIN can list all subscriptions and payments platform-wide</li> </ul> <p>Webhooks:</p> <ul> <li>Razorpay webhooks are handled by the system (signature-verified)</li> <li>Not user-facing</li> </ul>"},{"location":"functional-docs/#user-journeys","title":"User Journeys","text":""},{"location":"functional-docs/#listener-flow","title":"LISTENER Flow","text":"<p>1. Onboarding:</p> <ul> <li>Register in a tenant (e.g. via invite or tenant-specific signup)</li> <li>Receive verification email</li> <li>Verify with OTP</li> <li>Log in (request OTP \u2192 verify OTP \u2192 receive tokens)</li> </ul> <p>2. Discovery:</p> <ul> <li>Browse approved tenant songs only</li> <li>No direct access to full song catalog or genres</li> </ul> <p>3. Requests:</p> <ul> <li>Submit song requests</li> <li>View and manage own requests</li> <li>Optionally request password reset</li> </ul> <p>4. Playlists:</p> <ul> <li>Create playlists</li> <li>Add/remove approved tenant songs</li> <li>Update or delete own playlists</li> </ul> <p>5. Account:</p> <ul> <li>Update profile</li> <li>Change password</li> <li>Self-delete (can re-register later; previous content stays deleted)</li> </ul>"},{"location":"functional-docs/#admin-flow","title":"ADMIN Flow","text":"<p>1. Onboarding:</p> <ul> <li>Created by SUPER_ADMIN (or existing admin) within a tenant</li> <li>Verify email</li> <li>Log in via tenant-scoped OTP flow</li> </ul> <p>2. User management:</p> <ul> <li>Create LISTENER users</li> <li>View, update, delete LISTENER users in the tenant</li> <li>Restore admin-deleted users (with or without restoring content)</li> <li>Cannot delete self or other admins</li> </ul> <p>3. Content:</p> <ul> <li>Create/manage TENANT songs</li> <li>Link/unlink songs to the tenant</li> <li>Bulk add/remove tenant-song links</li> <li>View GLOBAL songs as reference (cannot modify)</li> </ul> <p>4. Requests:</p> <ul> <li>View all tenant song requests</li> <li>Create requests for any tenant user</li> <li>Approve/reject/fulfill requests</li> </ul> <p>5. Playlists:</p> <ul> <li>View, create, update, delete any tenant playlist</li> <li>Add/remove songs in any tenant playlist</li> </ul> <p>6. Tenant and billing:</p> <ul> <li>View tenant details (read-only)</li> <li>Create payment links</li> <li>View subscription status</li> </ul> <p>7. Account:</p> <ul> <li>Manage own profile and password</li> <li>Cannot self-delete</li> </ul>"},{"location":"functional-docs/#super_admin-flow","title":"SUPER_ADMIN Flow","text":"<p>1. Login:</p> <ul> <li>Use super-admin login (no tenant)</li> <li>Two-step OTP, then JWT</li> </ul> <p>2. Tenants:</p> <ul> <li>Create, update, activate, deactivate tenants</li> <li>Delete tenants only when they have no active users</li> <li>View all tenants and tenant details</li> </ul> <p>3. Catalog:</p> <ul> <li>Manage GLOBAL songs and genres</li> <li>No access to TENANT songs, tenant-song links, or any tenant-specific data</li> </ul> <p>4. Admins:</p> <ul> <li>Create ADMIN users for any tenant</li> <li>List all admins platform-wide</li> <li>View user counts only (no PII)</li> </ul> <p>5. Billing:</p> <ul> <li>View all subscriptions and payments</li> <li>No payment-link creation</li> </ul>"},{"location":"functional-docs/#system-behavior","title":"System Behavior","text":""},{"location":"functional-docs/#data-isolation","title":"Data Isolation","text":"<ul> <li>Tenant-scoped data is strictly isolated</li> <li>SUPER_ADMIN has no access to tenant-specific resources</li> <li>See Conventions for rules and rationale</li> </ul>"},{"location":"functional-docs/#user-deletion-and-restoration","title":"User Deletion and Restoration","text":"<p>Self-deletion (LISTENER):</p> <ul> <li>User deletes own account</li> <li>Content remains deleted</li> <li>User can re-register in the same tenant</li> <li>Account is restored, content is not</li> </ul> <p>Admin deletion:</p> <ul> <li>Admin deletes a LISTENER</li> <li>User is blocked from re-registration until restored</li> <li>Deleted user must contact support</li> </ul> <p>Restoration:</p> <ul> <li>Admin can restore an admin-deleted user</li> <li>Option to restore account only</li> <li>Option to restore account plus content (excluding content the user deleted themselves)</li> </ul>"},{"location":"functional-docs/#safeguards","title":"Safeguards","text":"<ul> <li>Admins cannot delete themselves or other admins</li> <li>Only LISTENER users can be deleted by admins</li> <li>Password change invalidates all tokens for that user</li> <li>Genre deletion is blocked when songs are linked</li> <li>See Conventions for rationale and enforcement</li> </ul>"},{"location":"functional-docs/#summary","title":"Summary","text":"<ul> <li>Role-based access</li> <li>Tenant isolation</li> <li>Clear platform vs tenant boundaries</li> <li>Per-resource access is documented in Authentication &amp; Authorization</li> </ul>"},{"location":"technical/api-design/","title":"API Design","text":""},{"location":"technical/api-design/#api-design","title":"API Design","text":"<p>The SongList API follows RESTful principles with a single base URL. All responses are JSON. Protected endpoints require JWT Bearer authentication. Access is controlled by permissions and queryset filtering, not by role-specific URLs.</p> <p>On this page</p> Section Description Base Configuration Base URL, auth API Grouping Auth, users, tenants, songs, etc. Data Scope Rules Own, tenant, global Error Handling 401, 403, 404, etc. Pagination Page, page_size"},{"location":"technical/api-design/#base-configuration","title":"Base Configuration","text":"<ul> <li>Base URL: <code>http://localhost:8000/api/v1</code></li> <li>Authentication: JWT (Access &amp; Refresh Tokens)</li> <li>Core Rule: Same resource \u2192 same endpoint; different access \u2192 permissions + queryset filtering</li> </ul> <p>No role-specific or admin-specific URLs are used for resources.</p>"},{"location":"technical/api-design/#rest-conventions","title":"REST Conventions","text":"<ul> <li>Resource-Based Endpoints: CRUD operations on nouns (users, songs, playlists, etc.)</li> <li>HTTP Methods: GET (list/retrieve), POST (create), PATCH (update), DELETE (delete)</li> <li>Ids: UUIDs for all primary keys</li> <li>Pagination: List endpoints support pagination (<code>page</code>, <code>page_size</code>)</li> </ul>"},{"location":"technical/api-design/#api-grouping","title":"API Grouping","text":""},{"location":"technical/api-design/#1-authentication-apis","title":"1. Authentication APIs","text":"Method Endpoint Access Notes POST <code>/api/v1/tenant/{tenant_id}/auth/register/</code> LISTENER only Self-deleted restoration POST <code>/api/v1/tenant/{tenant_id}/auth/verify-email/</code> All Verify OTP POST <code>/api/v1/tenant/{tenant_id}/auth/resend-verification/</code> All Resend OTP POST <code>/api/v1/tenant/{tenant_id}/auth/login/</code> All Step 1: Request OTP POST <code>/api/v1/tenant/{tenant_id}/auth/login/verify-otp/</code> All Step 2: Verify OTP, get JWT POST <code>/api/v1/auth/super-admin/login/</code> SUPER_ADMIN Step 1 POST <code>/api/v1/auth/super-admin/login/verify-otp/</code> SUPER_ADMIN Step 2 POST <code>/api/v1/auth/logout/</code> Authenticated Blacklist tokens POST <code>/api/v1/token/refresh/</code> All Refresh access token POST <code>/api/v1/tenant/{tenant_id}/auth/password-reset/</code> All Step 1 POST <code>/api/v1/tenant/{tenant_id}/auth/password-reset/confirm/</code> All Step 2 <p>Permissions: AllowAny for auth flows; IsAuthenticated for logout.</p>"},{"location":"technical/api-design/#2-user-management-apis","title":"2. User Management APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Data Scope GET <code>/api/v1/users/me/</code> \u2705 \u2705 \u2705 Own profile PATCH <code>/api/v1/users/me/</code> \u2705 \u2705 \u2705 Own profile DELETE <code>/api/v1/users/me/</code> \u2705 \u274c \u274c Self-delete POST <code>/api/v1/users/me/change-password/</code> \u2705 \u2705 \u2705 Own password GET <code>/api/v1/users/</code> \u274c \u2705 \u2705 Tenant list / Count only POST <code>/api/v1/users/</code> \u274c \u2705 \u2705 Create LISTENER / ADMIN GET <code>/api/v1/users/{id}/</code> \u274c \u2705 \u2705 View LISTENER / ADMIN PATCH <code>/api/v1/users/{id}/</code> \u274c \u2705 \u2705 Update LISTENER / ADMIN DELETE <code>/api/v1/users/{id}/</code> \u274c \u2705 \u2705 Delete LISTENER / ADMIN <p>Query params (GET /users/): <code>page</code>, <code>page_size</code>, <code>is_active</code>, <code>name</code>, <code>email</code>.</p> <p>User Deletion &amp; Restoration:</p> Method Endpoint Access Notes POST <code>/api/v1/users/{user_id}/restore/</code> ADMIN / SUPER ADMIN Body: <code>{\"restore_data\": true\\|false}</code> GET <code>/api/v1/users/deleted/</code> ADMIN / SUPER ADMIN ADMIN: tenant deleted users; SUPER_ADMIN: deleted admins <p>Query params (GET /users/deleted/): <code>page</code>, <code>page_size</code>, <code>deletion_type</code> (<code>self</code> | <code>admin</code> | <code>super admin</code>).</p> <p>Data filtering: ADMIN sees tenant users (full details); SUPER_ADMIN sees count only (no PII) for GET /users/.</p>"},{"location":"technical/api-design/#3-tenant-management-apis","title":"3. Tenant Management APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Notes GET <code>/api/v1/tenants/</code> \u274c \u274c \u2705 List all POST <code>/api/v1/tenants/</code> \u274c \u274c \u2705 Create GET <code>/api/v1/tenants/{id}/</code> \u274c \u2705 \u2705 Details (ADMIN read-only) PATCH <code>/api/v1/tenants/{id}/</code> \u274c \u274c \u2705 Update DELETE <code>/api/v1/tenants/{id}/</code> \u274c \u274c \u2705 Delete if no users PATCH <code>/api/v1/tenants/{id}/activate/</code> \u274c \u274c \u2705 Activate PATCH <code>/api/v1/tenants/{id}/deactivate/</code> \u274c \u274c \u2705 Deactivate GET <code>/api/v1/super-admin/admins/</code> \u274c \u274c \u2705 All admins <p>Query params (GET /tenants/): <code>page</code>, <code>page_size</code>.</p> <p>Query params (GET /super-admin/admins/): <code>page</code>, <code>page_size</code>, <code>is_active</code>, <code>name</code>, <code>email</code>, <code>tenant_id</code> (comma-separated UUIDs).</p> <p>Permissions: IsSuperAdmin for mutate; IsAdminOrSuperAdmin for GET detail.</p>"},{"location":"technical/api-design/#4-tenant-song-link-apis","title":"4. Tenant-Song Link APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Data Scope GET <code>/api/v1/tenant/songs/</code> \u2705 \u2705 \u274c Own tenant POST <code>/api/v1/tenant/songs/</code> \u274c \u2705 \u274c Own tenant GET <code>/api/v1/tenant/songs/{id}/</code> \u2705 \u2705 \u274c Own tenant DELETE <code>/api/v1/tenant/songs/{id}/</code> \u274c \u2705 \u274c Own tenant POST <code>/api/v1/songs/bulk-add/</code> \u274c \u2705 \u274c Bulk add to tenant POST <code>/api/v1/tenant/songs/bulk-delete/</code> \u274c \u2705 \u274c Bulk delete links <p>Query params (GET /tenant/songs/): <code>page</code>, <code>page_size</code>, <code>title</code>, <code>artist</code>, <code>genre</code>, <code>album</code> (all optional filters).</p> <p>LISTENER sees approved tenant songs only; ADMIN sees all in tenant. SUPER_ADMIN has no access.</p>"},{"location":"technical/api-design/#5-song-management-apis","title":"5. Song Management APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Data Scope GET <code>/api/v1/songs/</code> \u274c \u2705 \u2705 Tenant / GLOBAL POST <code>/api/v1/songs/</code> \u274c \u2705 \u2705 TENANT / GLOBAL GET <code>/api/v1/songs/{id}/</code> \u274c \u2705 \u2705 Tenant / GLOBAL PATCH <code>/api/v1/songs/{id}/</code> \u274c \u2705 \u2705 TENANT / GLOBAL DELETE <code>/api/v1/songs/{id}/</code> \u274c \u2705 \u2705 TENANT / GLOBAL <p>Query params (GET /songs/): <code>page</code>, <code>page_size</code>, <code>title</code>, <code>artist</code>, <code>genre</code>, <code>album</code> (all optional filters).</p> <p>Data separation: - LISTENER: No direct access; use <code>/api/v1/tenant/songs/</code>. - ADMIN: TENANT songs only (visibility=TENANT, tenant=user's tenant). - SUPER_ADMIN: GLOBAL songs only (visibility=GLOBAL).</p>"},{"location":"technical/api-design/#6-song-request-apis","title":"6. Song Request APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Data Scope GET <code>/api/v1/song-requests/</code> \u2705 \u2705 \u274c Own / Tenant POST <code>/api/v1/song-requests/</code> \u2705 \u2705 \u274c Own / Any user (tenant) GET <code>/api/v1/song-requests/{id}/</code> \u2705 \u2705 \u274c Own / Tenant PATCH <code>/api/v1/song-requests/{id}/</code> \u2705 \u2705 \u274c Own / Tenant DELETE <code>/api/v1/song-requests/{id}/</code> \u2705 \u2705 \u274c Own / Tenant POST <code>/api/v1/song-requests/{id}/review/</code> \u274c \u2705 \u274c Approve/Reject POST <code>/api/v1/song-requests/{id}/fulfill/</code> \u274c \u2705 \u274c Fulfill request <p>Query params (GET /song-requests/): <code>page</code>, <code>page_size</code>, <code>status</code> (ADMIN only; filter by request status).</p> <p>Permission: IsAuthenticated + IsTenantUser. ADMIN can create requests for any tenant user via <code>user_id</code>.</p>"},{"location":"technical/api-design/#7-playlist-apis","title":"7. Playlist APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Data Scope GET <code>/api/v1/playlists/</code> \u2705 \u2705 \u274c Own / Tenant POST <code>/api/v1/playlists/</code> \u2705 \u2705 \u274c Own / Any user (tenant) GET <code>/api/v1/playlists/{id}/</code> \u2705 \u2705 \u274c Own / Tenant PATCH <code>/api/v1/playlists/{id}/</code> \u2705 \u2705 \u274c Own / Tenant DELETE <code>/api/v1/playlists/{id}/</code> \u2705 \u2705 \u274c Own / Tenant GET <code>/api/v1/playlists/{id}/songs/</code> \u2705 \u2705 \u274c Own / Tenant POST <code>/api/v1/playlists/{id}/songs/</code> \u2705 \u2705 \u274c Own / Tenant DELETE <code>/api/v1/playlists/{id}/songs/</code> \u2705 \u2705 \u274c Own / Tenant DELETE <code>/api/v1/playlists/{playlist_id}/songs/{song_id}/</code> \u2705 \u2705 \u274c Remove song <p>Query params (GET /playlists/): <code>page</code>, <code>page_size</code>. Query params (GET /playlists/{id}/songs/): <code>page</code>, <code>page_size</code>.</p> <p>Permission: IsAuthenticated; IsOwnerOrAdmin for detail. SUPER_ADMIN has no access.</p>"},{"location":"technical/api-design/#8-genre-apis","title":"8. Genre APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Notes GET <code>/api/v1/genres/</code> \u274c \u2705 \u2705 Read-only POST <code>/api/v1/genres/</code> \u274c \u274c \u2705 Create GET <code>/api/v1/genres/{id}/</code> \u274c \u2705 \u2705 Read-only PATCH <code>/api/v1/genres/{id}/</code> \u274c \u274c \u2705 Update DELETE <code>/api/v1/genres/{id}/</code> \u274c \u274c \u2705 Only if no songs linked <p>Query params (GET /genres/): <code>page</code>, <code>page_size</code>.</p>"},{"location":"technical/api-design/#9-payment-apis","title":"9. Payment APIs","text":"Method Endpoint LISTENER ADMIN SUPER_ADMIN Notes POST <code>/api/v1/payments/create-payment-link/</code> \u274c \u2705 \u274c Razorpay link GET <code>/api/v1/payments/subscription/</code> \u274c \u2705 \u2705 Tenant subscription POST <code>/api/v1/payments/webhook/razorpay/</code> \u2014 \u2014 \u2014 Public, signature verified GET <code>/api/v1/payments/super-admin/subscriptions/</code> \u274c \u274c \u2705 All subscriptions GET <code>/api/v1/payments/super-admin/payments/</code> \u274c \u274c \u2705 All payments <p>Query params (GET /payments/super-admin/subscriptions/): <code>page</code>, <code>page_size</code>, <code>tenant_id</code>, <code>is_premium</code>.</p> <p>Query params (GET /payments/super-admin/payments/): <code>page</code>, <code>page_size</code>, <code>tenant_id</code>, <code>status</code>.</p>"},{"location":"technical/api-design/#data-scope-rules","title":"Data Scope Rules","text":""},{"location":"technical/api-design/#own-data","title":"Own Data","text":"<ul> <li>Profile (<code>/users/me/</code>), own playlists, own song requests.</li> <li>LISTENER-only: self-delete.</li> </ul>"},{"location":"technical/api-design/#tenant-data","title":"Tenant Data","text":"<ul> <li>Users, playlists, song requests, tenant-song links, TENANT songs.</li> <li>ADMIN: full CRUD within tenant. LISTENER: own resources only.</li> </ul>"},{"location":"technical/api-design/#global-data","title":"Global Data","text":"<ul> <li>Tenants, GLOBAL songs, genres, platform subscriptions/payments.</li> <li>SUPER_ADMIN only (except tenant detail GET for ADMIN).</li> </ul>"},{"location":"technical/api-design/#object-ownership-rules","title":"Object Ownership Rules","text":"<ul> <li>IsOwnerOrAdmin: Owner or ADMIN in same tenant can access. SUPER_ADMIN excluded from tenant objects.</li> <li>Tenant Membership: All tenant-scoped access checks <code>user.tenant</code> vs object\u2019s tenant.</li> <li>Cross-Tenant: ADMIN cannot access other tenants\u2019 data.</li> </ul>"},{"location":"technical/api-design/#error-handling","title":"Error Handling","text":"Code Meaning 401 Unauthorized Missing or invalid token 403 Forbidden Valid token but insufficient permissions 404 Not Found Resource does not exist or outside caller\u2019s scope 400 Bad Request Validation or malformed request 409 Conflict Duplicate or constraint violation 500 Internal Server Error Unexpected server error <ul> <li>Prefer 403 when the user is authenticated but not allowed to perform the action.</li> <li>Use 404 when the resource is unknown or not in scope (no info leakage about existence).</li> </ul>"},{"location":"technical/api-design/#pagination","title":"Pagination","text":"<p>List endpoints use page-based pagination.</p> <ul> <li>Query params: <code>page</code>, <code>page_size</code> (default/max per project settings).</li> <li>Response: <code>count</code>, <code>page</code>, <code>page_size</code>, <code>next</code>, <code>previous</code>, <code>data</code>.</li> </ul>"},{"location":"technical/authentication/","title":"Authentication & Authorization","text":""},{"location":"technical/authentication/#authentication-authorization","title":"Authentication &amp; Authorization","text":"<p>SongList Backend uses role-based access control (RBAC) with three distinct roles and strict tenant isolation. Authentication is OTP-based with JWT tokens, and permissions enforce data access boundaries.</p> <p>On this page</p> Section Description Roles Role summary Role Capabilities Matrix Per-action access by role Authentication Flow Registration, login, OTP, tokens Permission Classes AllowAny, IsAuthenticated, etc. User Deletion &amp; Restoration Self-delete, admin delete, restore Data Isolation Summary Per-resource access matrix"},{"location":"technical/authentication/#roles","title":"Roles","text":"<p>LISTENER</p> <ul> <li>Tenant users</li> <li>Own profile, playlists, song requests</li> <li>Approved tenant songs only</li> <li>Can self-delete</li> </ul> <p>ADMIN</p> <ul> <li>Tenant-scoped</li> <li>Full CRUD on tenant users, playlists, requests, tenant-song links, TENANT songs</li> <li>Cannot delete self or other admins</li> </ul> <p>SUPER_ADMIN</p> <ul> <li>Platform only</li> <li>Tenants, GLOBAL songs, genres, metrics</li> <li>View/update/delete ADMIN users; view/restore deleted admins</li> <li>No LISTENER or tenant data access</li> </ul> <p>See Functional Documentation for capabilities and Conventions for boundaries.</p>"},{"location":"technical/authentication/#authorization","title":"Authorization","text":""},{"location":"technical/authentication/#role-capabilities-matrix","title":"Role Capabilities Matrix","text":"Action LISTENER ADMIN SUPER_ADMIN Authentication Register (LISTENER only) \u2705 \u274c (contact admin) \u274c (contact admin) Verify Email \u2705 \u2705 \u2705 Request OTP \u2705 \u2705 \u2705 Verify OTP \u2705 \u2705 \u2705 Refresh Token \u2705 \u2705 \u2705 Change Password \u2705 \u2705 \u2705 Password Reset \u2705 \u2705 \u2705 Logout \u2705 \u2705 \u2705 Resend Verification \u2705 \u2705 \u2705 User Management View Own Profile \u2705 \u2705 \u2705 Update Own Profile \u2705 \u2705 \u2705 Delete Own Account \u2705 (self-delete) \u274c (safety) \u274c Create LISTENER User \u274c \u2705 (own tenant) \u274c Create ADMIN User \u274c \u274c \u2705 (any tenant) View All Users \u274c \u2705 (tenant only) \u2705 (count only, no PII) View Any User \u274c \u2705 (tenant only) \u2705 (ADMIN only) Update Any User \u274c \u2705 (tenant only) \u2705 (ADMIN only) Delete Any User \u274c \u2705 (tenant only, LISTENER only, not self) \u2705 (ADMIN only) Restore Deleted User \u274c \u2705 (tenant only) \u2705 (deleted admins only) View Deleted Users \u274c \u2705 (tenant only) \u2705 (deleted admins only, platform-wide) Tenant Management View Tenants \u274c \u274c \u2705 (all) Create Tenant \u274c \u274c \u2705 Update Tenant \u274c \u274c \u2705 Activate Tenant \u274c \u274c \u2705 Deactivate Tenant \u274c \u274c \u2705 Delete Tenant \u274c \u274c \u2705 (if no users) View Tenant Details \u274c \u2705 (GET only) \u2705 View All Admins \u274c \u274c \u2705 (platform-wide) Tenant-Song Links View Tenant Songs \u2705 (approved only) \u2705 (all, own tenant) \u274c (no data access) View Tenant Song Detail \u2705 (approved only) \u2705 (all, own tenant) \u274c (no data access) Link Song to Tenant \u274c \u2705 (own tenant) \u274c (no data access) Bulk Add Songs \u274c \u2705 (own tenant) \u274c (no data access) Unlink Song \u274c \u2705 (own tenant) \u274c (no data access) Bulk Delete Tenant Songs \u274c \u2705 (own tenant) \u274c (no data access) Song Management View Songs \u274c (use tenant/songs) \u2705 (all, tenant) \u2705 (GLOBAL only) View Song Details \u274c (use tenant/songs) \u2705 (all, tenant) \u2705 (GLOBAL only) Create Song \u274c \u2705 (TENANT songs) \u2705 (GLOBAL songs) Update Song \u274c \u2705 (TENANT songs) \u2705 (GLOBAL songs) Delete Song \u274c \u2705 (TENANT songs) \u2705 (GLOBAL songs) Song Requests Create Song Request \u2705 (own) \u2705 (any user, tenant) \u274c View Any Request \u2705 (own only) \u2705 (any, tenant) \u274c (no data access) Update Any Request \u2705 (own only) \u2705 (any, tenant) \u274c (no data access) Delete Any Request \u2705 (own only) \u2705 (any, tenant) \u274c (no data access) View All Requests \u274c \u2705 (tenant only) \u274c (no data access) Review Requests \u274c \u2705 (tenant only) \u274c (no data access) Playlist Management View Playlists \u2705 (own) \u2705 (tenant) \u274c (no data access) Create Playlist \u2705 (own) \u2705 (any user, tenant) \u274c (no data access) View Playlist Details \u2705 (own) \u2705 (tenant) \u274c (no data access) Update Playlist \u2705 (own) \u2705 (tenant) \u274c (no data access) Delete Playlist \u2705 (own) \u2705 (tenant) \u274c (no data access) Get Playlist Songs \u2705 (own) \u2705 (tenant) \u274c (no data access) Add Song to Playlist \u2705 (own) \u2705 (tenant) \u274c (no data access) Remove Song from Playlist \u2705 (own) \u2705 (tenant) \u274c (no data access) Genre Management View Genres \u274c \u2705 \u2705 View Genre Detail \u274c \u2705 \u2705 Create Genre \u274c \u274c \u2705 Update Genre \u274c \u274c \u2705 Delete Genre \u274c \u274c \u2705 (no linked songs) Payments Create Payment Link \u274c \u2705 \u274c View Subscription Status \u274c \u2705 \u2705 View All Subscriptions \u274c \u274c \u2705 View All Payments \u274c \u274c \u2705 Handle Webhooks \u274c \u274c \u274c"},{"location":"technical/authentication/#authentication-flow","title":"Authentication Flow","text":""},{"location":"technical/authentication/#registration","title":"Registration","text":"<ul> <li>Endpoint: <code>POST /api/v1/tenant/{tenant_id}/auth/register/</code></li> <li>Access: LISTENER only (ADMIN and SUPER_ADMIN blocked)</li> <li>Process:</li> <li>User provides username, email, password, confirm_password</li> <li>Account created with <code>is_verified=false</code></li> <li>Verification email sent with OTP</li> <li>User must verify email before login</li> <li>Special Behavior: Automatically restores self-deleted accounts</li> </ul>"},{"location":"technical/authentication/#email-verification","title":"Email Verification","text":"<ul> <li>Endpoint: <code>POST /api/v1/tenant/{tenant_id}/auth/verify-email/</code></li> <li>Access: All users (unverified accounts)</li> <li>Process:</li> <li>User provides OTP received via email</li> <li>OTP verified against cache</li> <li>Account marked as verified</li> </ul>"},{"location":"technical/authentication/#login-two-step-otp","title":"Login (Two-Step OTP)","text":"<p>Step 1: Request OTP</p> <ul> <li>Endpoint: <code>POST /api/v1/tenant/{tenant_id}/auth/login/</code></li> <li>Access: All verified users</li> <li>Process: </li> <li>User provides username/email and password</li> <li>Password verified</li> <li>OTP sent to email</li> <li>OTP cached in Redis</li> </ul> <p>Step 2: Verify OTP</p> <ul> <li>Endpoint: <code>POST /api/v1/tenant/{tenant_id}/auth/login/verify-otp/</code></li> <li>Access: All verified users</li> <li>Process:</li> <li>User provides OTP</li> <li>OTP verified against cache</li> <li>JWT access and refresh tokens issued</li> <li>OTP invalidated</li> </ul>"},{"location":"technical/authentication/#super-admin-login","title":"Super Admin Login","text":"<ul> <li>Step 1: <code>POST /api/v1/auth/super-admin/login/</code> (no tenant required)</li> <li>Step 2: <code>POST /api/v1/auth/super-admin/login/verify-otp/</code></li> <li>Access: SUPER_ADMIN only</li> </ul>"},{"location":"technical/authentication/#token-refresh","title":"Token Refresh","text":"<ul> <li>Endpoint: <code>POST /api/v1/token/refresh/</code></li> <li>Access: All authenticated users</li> <li>Process:</li> <li>User provides valid refresh token</li> <li>New access token issued</li> <li>Old refresh token blacklisted (token rotation)</li> <li>Token Rotation: Enabled (old refresh token blacklisted)</li> </ul>"},{"location":"technical/authentication/#password-reset","title":"Password Reset","text":"<p>Step 1: Request Reset OTP</p> <ul> <li>Endpoint: <code>POST /api/v1/tenant/{tenant_id}/auth/password-reset/</code></li> <li>Access: All users</li> <li>Process:</li> <li>User requests password reset with email/username</li> <li>OTP sent to registered email</li> <li>OTP cached in Redis</li> </ul> <p>Step 2: Confirm New Password</p> <ul> <li>Endpoint: <code>POST /api/v1/tenant/{tenant_id}/auth/password-reset/confirm/</code></li> <li>Access: All users</li> <li>Process:</li> <li>User provides OTP and new password</li> <li>OTP verified against cache</li> <li>New password set</li> <li>OTP invalidated</li> </ul>"},{"location":"technical/authentication/#change-password","title":"Change Password","text":"<ul> <li>Endpoint: <code>POST /api/v1/users/me/change-password/</code></li> <li>Access: All authenticated users</li> <li>Security: Blacklists all active access and refresh tokens (forces re-login on all devices)</li> </ul>"},{"location":"technical/authentication/#logout","title":"Logout","text":"<ul> <li>Endpoint: <code>POST /api/v1/auth/logout/</code></li> <li>Access: All authenticated users</li> <li>Process:</li> <li>Refresh token blacklisted</li> <li>Access token denylisted</li> </ul>"},{"location":"technical/authentication/#permission-classes","title":"Permission Classes","text":""},{"location":"technical/authentication/#allowany","title":"AllowAny","text":"<p>Public access for:</p> <ul> <li>Registration</li> <li>Email verification</li> <li>Login (OTP request &amp; verify)</li> <li>Password reset</li> <li>Resend verification</li> </ul>"},{"location":"technical/authentication/#isauthenticated","title":"IsAuthenticated","text":"<p>Logged-in users only. Used for:</p> <ul> <li>Profile management</li> <li>Change password</li> <li>Songs, playlists, genres</li> <li>Tenant-song links</li> <li>Song requests</li> </ul>"},{"location":"technical/authentication/#issuperadmin","title":"IsSuperAdmin","text":"<p>Platform management only. Used for:</p> <ul> <li>Tenant CRUD (except GET detail)</li> <li>Activate/deactivate tenants</li> <li>Genre CRUD</li> <li>Admin listing</li> <li>Payment/subscription listing</li> </ul>"},{"location":"technical/authentication/#isadmin","title":"IsAdmin","text":"<p>Tenant data management. Used for:</p> <ul> <li>User management</li> <li>Tenant-song links</li> <li>Song request review</li> <li>User deletion/restoration</li> <li>Bulk song operations</li> <li>Payment link creation</li> </ul>"},{"location":"technical/authentication/#isadminorsuperadmin","title":"IsAdminOrSuperAdmin","text":"<p>Admin or Super Admin access. Used for: - User creation/list - Subscription status - Tenant detail GET</p>"},{"location":"technical/authentication/#isowneroradmin","title":"IsOwnerOrAdmin","text":"<p>Object-level permission:</p> <ul> <li>ADMIN can access any object in their tenant</li> <li>Owner can access their own object</li> <li>Blocks SUPER_ADMIN from tenant data</li> </ul> <p>Used for: Playlist detail operations</p>"},{"location":"technical/authentication/#istenantuser","title":"IsTenantUser","text":"<p>Tenant members only (blocks SUPER_ADMIN). Used for:</p> <ul> <li>Song request endpoints</li> </ul>"},{"location":"technical/authentication/#user-deletion-restoration","title":"User Deletion &amp; Restoration","text":""},{"location":"technical/authentication/#self-deletion","title":"Self-Deletion","text":"<p>Process:</p> <ol> <li>User calls <code>DELETE /api/v1/users/me/</code></li> <li><code>deleted_by</code> set to user's own ID</li> <li>User's content (songs, playlists) marked as deleted</li> <li>User can re-register via <code>/api/v1/tenant/{tenant_id}/auth/register/</code></li> <li>Account automatically restored on re-registration</li> <li>Content stays deleted (not restored)</li> </ol> <p>Access: LISTENER only (ADMIN and SUPER_ADMIN blocked for safety)</p>"},{"location":"technical/authentication/#admin-deletion","title":"Admin Deletion","text":"<p>Process:</p> <ol> <li>ADMIN calls <code>DELETE /api/v1/users/{user_id}/delete/</code></li> <li><code>deleted_by</code> set to admin's ID</li> <li>User's active songs/playlists marked as deleted</li> <li>User blocked from re-registration</li> <li>Registration attempt returns: \"Your account has been deleted by admin. Please contact support.\"</li> </ol> <p>Rules: - Cannot delete themselves - Cannot delete other ADMIN or SUPER_ADMIN users - Can only delete LISTENER users in their tenant</p>"},{"location":"technical/authentication/#admin-restoration","title":"Admin Restoration","text":"<p>Endpoint: <code>POST /api/v1/users/{user_id}/restore/</code></p> <p>Options:</p> <p>Without Data (<code>restore_data=false</code>):</p> <ul> <li>Account restored (user can login)</li> <li>All content stays deleted</li> </ul> <p>With Data (<code>restore_data=true</code>):</p> <ul> <li>Account restored</li> <li>ALL deleted songs/playlists restored EXCEPT items user deleted themselves</li> <li>Includes content deleted by admin during user deletion</li> <li>Includes content deleted by other admins</li> <li>Excludes content where <code>deleted_by == user_id</code></li> </ul> <p>Access: ADMIN (tenant-scoped, any deleted user in tenant); SUPER_ADMIN (deleted admins only, platform-wide).</p>"},{"location":"technical/authentication/#data-isolation-summary","title":"Data Isolation Summary","text":"Resource LISTENER ADMIN SUPER_ADMIN Users Own only Tenant only Count only (no PII) Songs \u274c No direct access (use tenant/songs) TENANT (own tenant) GLOBAL only Playlists Own only Tenant only (full CRUD) \u274c No access Song Requests Own only Tenant only \u274c No access Tenant-Songs Approved only Own tenant (full CRUD) \u274c No access Genres \u274c No access Read-only Full control Payments \u274c No access Create payment links, view subscription View all subscriptions/payments Tenants \u274c No access View details (read-only) Full control <p>Security guardrails (tenant isolation, deletion rules, password-change behavior) are in Conventions.</p>"},{"location":"technical/conventions/","title":"Conventions & Guardrails","text":""},{"location":"technical/conventions/#conventions-guardrails","title":"Conventions &amp; Guardrails","text":"<p>Rules and design choices that govern tenant isolation, resource scoping, roles, and security.</p> <p>On this page</p> Section Description Tenant Isolation Rules Strict isolation, queryset filtering GLOBAL vs TENANT Resource Rules Platform vs tenant data Role Boundaries SUPER_ADMIN, ADMIN, LISTENER Security Decisions No tenant data for super admin, etc. Design Philosophy Same endpoint, fail closed, soft deletes"},{"location":"technical/conventions/#tenant-isolation-rules","title":"Tenant Isolation Rules","text":"<ul> <li>Strict isolation: An ADMIN can never access data belonging to another tenant.</li> <li>Tenant context: Tenant is determined by the authenticated user (<code>user.tenant</code>). LISTENER and ADMIN always have a tenant; SUPER_ADMIN does not.</li> <li>URL-based tenant in auth: Tenant-scoped auth endpoints include <code>tenant_id</code> in the path (<code>/api/v1/tenant/{tenant_id}/auth/...</code>). The backend validates that the tenant exists and is active.</li> <li>Queryset filtering: Tenant-scoped resources are filtered by <code>tenant</code> (or <code>user.tenant</code>) in views. Use tenant-aware managers where applicable (e.g. <code>User.objects</code> vs <code>User.all_users</code>).</li> <li>No cross-tenant queries: Avoid any query that could return rows from multiple tenants for tenant-scoped resources.</li> </ul>"},{"location":"technical/conventions/#global-vs-tenant-resource-rules","title":"GLOBAL vs TENANT Resource Rules","text":""},{"location":"technical/conventions/#global-resources","title":"GLOBAL Resources","text":"<ul> <li>Definition: Platform-level data shared across tenants or used only by platform administration.</li> <li>Examples: GLOBAL songs, genres, tenants, platform-wide subscription/payment lists.</li> <li>Who manages: SUPER_ADMIN only (except tenant detail GET, which ADMIN can do for own tenant).</li> <li>Who can access: Varies by resource (e.g. ADMIN can read GLOBAL songs and genres; LISTENER cannot access genres).</li> </ul>"},{"location":"technical/conventions/#tenant-resources","title":"TENANT Resources","text":"<ul> <li>Definition: Data that belongs to a single tenant.</li> <li>Examples: TENANT songs, tenant-song links, playlists, song requests, tenant users.</li> <li>Who manages: ADMIN (within own tenant); LISTENER (own data only).</li> <li>Who can access: ADMIN for full tenant scope; LISTENER for own scope only. SUPER_ADMIN has no access to tenant resources.</li> </ul>"},{"location":"technical/conventions/#song-visibility","title":"Song Visibility","text":"<ul> <li><code>visibility</code> field: <code>GLOBAL</code> or <code>TENANT</code>.</li> <li>GLOBAL songs: Created and managed by SUPER_ADMIN. Can be linked to tenants via tenant-song links by ADMIN.</li> <li>TENANT songs: Created and managed by tenant ADMIN. Visible only within that tenant.</li> <li>Enforcement: Implemented in song views and permissions (role-based filtering).</li> </ul>"},{"location":"technical/conventions/#role-boundaries","title":"Role Boundaries","text":""},{"location":"technical/conventions/#super_admin","title":"SUPER_ADMIN","text":"<p>Scope:</p> <ul> <li>Platform only</li> <li>No tenant</li> </ul> <p>Can:</p> <ul> <li>Manage tenants</li> <li>Manage GLOBAL songs</li> <li>Manage genres</li> <li>Create ADMINs</li> <li>View platform metrics (user counts, subscriptions, payments)</li> <li>List all admins</li> </ul> <p>Cannot:</p> <ul> <li>Access any tenant-specific data (users, playlists, song requests, tenant-song links, TENANT songs)</li> <li>Access PII</li> </ul>"},{"location":"technical/conventions/#admin","title":"ADMIN","text":"<p>Scope:</p> <ul> <li>Single tenant (<code>user.tenant</code>)</li> </ul> <p>Can:</p> <ul> <li>Full CRUD on tenant users (except delete self or other admins)</li> <li>Full CRUD on TENANT songs</li> <li>Full CRUD on tenant-song links</li> <li>Full CRUD on playlists</li> <li>Full CRUD on song requests</li> <li>Create payment links</li> <li>View tenant subscription</li> <li>View tenant details</li> </ul> <p>Cannot:</p> <ul> <li>Access other tenants</li> <li>Manage GLOBAL songs</li> <li>Manage genres</li> <li>Delete self</li> <li>Delete other ADMIN/SUPER_ADMIN users</li> </ul>"},{"location":"technical/conventions/#listener","title":"LISTENER","text":"<p>Scope:</p> <ul> <li>Own data only within their tenant</li> </ul> <p>Can:</p> <ul> <li>Manage profile</li> <li>Manage own playlists</li> <li>Manage own song requests</li> <li>View approved tenant songs via <code>/api/v1/tenant/songs/</code></li> <li>Self-delete</li> </ul> <p>Cannot:</p> <ul> <li>Access <code>/api/v1/songs/</code> directly</li> <li>Access genres</li> <li>Manage other users</li> <li>Access other users\u2019 playlists</li> </ul>"},{"location":"technical/conventions/#security-decisions","title":"Security Decisions","text":""},{"location":"technical/conventions/#super_admin-and-tenant-data","title":"SUPER_ADMIN and Tenant Data","text":"<ul> <li>Decision: SUPER_ADMIN has zero access to tenant data.</li> <li>Rationale: Reduces attack surface and enforces separation between platform operations and tenant data. Platform admins manage configuration and global content, not tenant PII or content.</li> <li>Enforcement: Permission classes (e.g. <code>IsTenantUser</code>, <code>IsOwnerOrAdmin</code>) and view logic explicitly block SUPER_ADMIN from tenant-scoped endpoints.</li> </ul>"},{"location":"technical/conventions/#admin-self-deletion","title":"Admin Self-Deletion","text":"<ul> <li>Decision: Admins cannot delete their own accounts (via any endpoint).</li> <li>Rationale: Prevents lockout and accidental loss of tenant administration.</li> <li>Enforcement: User deletion logic checks that the target is not the requesting user and that the target is a LISTENER.</li> </ul>"},{"location":"technical/conventions/#deletion-of-other-admins","title":"Deletion of Other Admins","text":"<ul> <li>Decision: Only LISTENER users can be deleted by an ADMIN.</li> <li>Rationale: Keeps admin lifecycle under control (e.g. via SUPER_ADMIN or out-of-band processes).</li> <li>Enforcement: Admin delete endpoints restrict targets to LISTENER.</li> </ul>"},{"location":"technical/conventions/#user-creation-and-verification","title":"User Creation and Verification","text":"<ul> <li>Decision: LISTENER self-registers; ADMIN created by SUPER_ADMIN; ADMIN creates LISTENER. All created users must verify email before login.</li> <li>Rationale: Ensures valid, reachable identities and controlled admin provisioning.</li> <li>Enforcement: Registration and user-creation flows; <code>is_verified</code> and email verification checks at login.</li> </ul>"},{"location":"technical/conventions/#password-change-and-sessions","title":"Password Change and Sessions","text":"<ul> <li>Decision: Changing password blacklists all access and refresh tokens.</li> <li>Rationale: Forces re-login everywhere after a password change, limiting exposure if a password was compromised.</li> <li>Enforcement: Password-change handler invalidates tokens accordingly.</li> </ul>"},{"location":"technical/conventions/#genre-and-tenant-deletion","title":"Genre and Tenant Deletion","text":"<ul> <li>Genre: Cannot delete a genre that has any linked (non\u2013soft-deleted) songs.</li> <li>Tenant: Cannot delete a tenant that has any active users.</li> <li>Enforcement: Implemented in model delete logic or view logic, returning clear errors when constraints are violated.</li> </ul>"},{"location":"technical/conventions/#design-philosophy","title":"Design Philosophy","text":"<ul> <li>Same resource, same endpoint: One set of URLs per resource. Access differences are enforced by permissions and queryset filtering, not by separate role-specific routes.</li> <li>Explicit scope: Always filter by tenant (or ownership) in tenant-scoped APIs. Avoid implicit or optional tenant context.</li> <li>Fail closed: Unclear or missing permission leads to denial (403), not grant.</li> <li>Soft deletes: Deletions are soft where applicable (<code>deleted_at</code>). Supports restore and audit; hard delete only when necessary and safe.</li> <li>Object-level checks: For ownership-sensitive resources (e.g. playlists), use object-level permissions (e.g. <code>IsOwnerOrAdmin</code>) in addition to view-level checks.</li> </ul>"},{"location":"technical/core-modules/","title":"Core Modules","text":""},{"location":"technical/core-modules/#core-modules","title":"Core Modules","text":"<p>Purpose, access rules, data scope, and business rules per module. Endpoints: API Design.</p>"},{"location":"technical/core-modules/#on-this-page","title":"On this page","text":"Module Description Users Auth, profile, tenant user admin Tenants Organizations, SUPER_ADMIN management Songs GLOBAL vs TENANT catalog Tenant-Song Links Link songs to tenants Playlists User playlists, ADMIN management Song Requests Request, review, fulfill Genres Platform-wide categories Payments Razorpay, subscriptions"},{"location":"technical/core-modules/#users","title":"Users","text":"<p>Purpose: Authentication, profile management, and tenant user administration.</p> <p>Who can access: - LISTENER: Own profile only; self-delete allowed. - ADMIN: Tenant users (full CRUD); delete/restore LISTENER only; cannot delete self or other admins. - SUPER_ADMIN: User count only (no PII); create ADMIN for any tenant; list all admins.</p> <p>Data scope: - Own (LISTENER) - Tenant (ADMIN) - Platform count / admin list (SUPER_ADMIN)</p> <p>Business rules: - Email unique per tenant (LISTENER/ADMIN); globally unique for SUPER_ADMIN. - LISTENER/ADMIN must have a tenant; SUPER_ADMIN must not. - All created users must verify email before login. - Password change blacklists all access and refresh tokens.</p>"},{"location":"technical/core-modules/#tenants","title":"Tenants","text":"<p>Purpose: Multi-tenant organizations. Managed by SUPER_ADMIN; ADMIN can view their tenant only.</p> <p>Who can access: - LISTENER: No access. - ADMIN: GET tenant details only (own tenant). - SUPER_ADMIN: Full CRUD, activate, deactivate.</p> <p>Data scope: - Global (platform-level resource)</p> <p>Business rules: - Tenant cannot be deleted if it has any active users. - Soft delete; unique name among non-deleted tenants.</p>"},{"location":"technical/core-modules/#songs","title":"Songs","text":"<p>Purpose: Song catalog with GLOBAL vs TENANT visibility. GLOBAL = platform; TENANT = tenant-specific.</p> <p>Who can access: - LISTENER: No direct access; use <code>/api/v1/tenant/songs/</code> for approved tenant songs. - ADMIN: TENANT songs in own tenant (and read GLOBAL); create/update/delete TENANT songs. - SUPER_ADMIN: GLOBAL songs only; create/update/delete GLOBAL songs.</p> <p>Data scope: - GLOBAL (platform) - TENANT (per tenant)</p> <p>Business rules: - <code>visibility</code> is <code>GLOBAL</code> or <code>TENANT</code>. - Release year validated (minimum year, not in future). - Songs link to genre (required); genre protected from deletion when linked.</p>"},{"location":"technical/core-modules/#tenant-song-links","title":"Tenant-Song Links","text":"<p>Purpose: Link songs to tenants. Controls which songs a tenant can use; admins manage links.</p> <p>Who can access: - LISTENER: List/detail approved tenant songs only. - ADMIN: Full CRUD on own tenant\u2019s links; bulk add/delete. - SUPER_ADMIN: No access.</p> <p>Data scope: - Tenant-only</p> <p>Business rules: - Unique song per tenant (one link per song per tenant). - <code>is_active</code> flags link state. - Soft delete on links.</p>"},{"location":"technical/core-modules/#playlists","title":"Playlists","text":"<p>Purpose: User-defined song collections. Owned by users; admins can manage all playlists in their tenant.</p> <p>Who can access: - LISTENER: Own playlists only. - ADMIN: All playlists in tenant; can create on behalf of users (<code>user_id</code>). - SUPER_ADMIN: No access.</p> <p>Data scope: - Tenant (via playlist owner\u2019s tenant)</p> <p>Business rules: - Playlist name unique per user (among non-deleted). - Only approved tenant songs can be added (enforced where used). - Object-level permission: owner or ADMIN in same tenant.</p>"},{"location":"technical/core-modules/#song-requests","title":"Song Requests","text":"<p>Purpose: Users request songs; admins review and fulfill (approve/reject, link or create song).</p> <p>Who can access: - LISTENER: Own requests only. - ADMIN: All requests in tenant; create for any tenant user; review and fulfill. - SUPER_ADMIN: No access.</p> <p>Data scope: - Tenant-only</p> <p>Business rules: - Status flow: <code>PENDING \u2192 APPROVED | REJECTED | FULFILLED</code>. - Unique <code>(song_title, tenant)</code> per request (model constraint). - ADMIN can create requests with <code>user_id</code> for any tenant user.</p>"},{"location":"technical/core-modules/#genres","title":"Genres","text":"<p>Purpose: Platform-wide song categorization. SUPER_ADMIN manages; ADMIN read-only.</p> <p>Who can access: - LISTENER: No access. - ADMIN: Read-only (list, detail). - SUPER_ADMIN: Full CRUD.</p> <p>Data scope: - Global</p> <p>Business rules: - Genre cannot be deleted if any non\u2013soft-deleted song is linked. - Name unique globally.</p>"},{"location":"technical/core-modules/#payments","title":"Payments","text":"<p>Purpose: Razorpay premium subscriptions (lifetime). Payment links, webhooks, subscription status.</p> <p>Who can access: - LISTENER: No access. - ADMIN: Create payment link; view tenant subscription status. - SUPER_ADMIN: List all subscriptions and payments; no payment-link creation.</p> <p>Data scope: - Tenant (links, subscription) - Platform (SUPER_ADMIN lists)</p> <p>Business rules: - Payment state machine: <code>CREATED \u2192 PENDING \u2192 PAID \u2192 VERIFIED \u2192 ACTIVATED</code> (or <code>FAILED</code>). - Webhook signature verification required. - Premium stored on tenant\u2019s <code>Subscription</code> (e.g. <code>is_premium</code>). - Idempotent processing for webhooks where applicable.</p>"},{"location":"technical/developer-setup/","title":"Developer Setup","text":""},{"location":"technical/developer-setup/#developer-setup","title":"Developer Setup","text":"<p>Short, operational guide to run the SongList Backend locally.</p> <p>On this page</p> Section Description Prerequisites Python, PostgreSQL, Redis, Razorpay Environment Variables .env reference Local Setup Clone, configure, DB, run Migrations makemigrations, migrate Seeding seed_genres, seed_tenants, seed_songs"},{"location":"technical/developer-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.13+</li> <li>PostgreSQL</li> <li>Redis (cache, Celery broker)</li> <li>Razorpay account (sandbox for development)</li> </ul>"},{"location":"technical/developer-setup/#environment-variables","title":"Environment Variables","text":"<p>Create a <code>.env</code> file in the project root. The app reads these via <code>python-dotenv</code>.</p> Variable Description Example <code>SECRET_KEY</code> Django secret key <code>your-secret-key-here</code> <code>DEBUG</code> Debug mode (<code>1</code>/<code>0</code>) <code>1</code> <code>ALLOWED_HOSTS</code> Comma-separated hosts <code>localhost,127.0.0.1</code> <code>DB_NAME</code> PostgreSQL database name <code>songlist_db</code> <code>DB_USER</code> Database user <code>postgres</code> <code>DB_PASSWORD</code> Database password \u2014 <code>DB_HOST</code> Database host <code>localhost</code> <code>DB_PORT</code> Database port <code>5432</code> <code>REDIS_URL</code> Redis URL <code>redis://127.0.0.1:6379/1</code> <code>CELERY_BROKER_URL</code> Celery broker <code>redis://127.0.0.1:6379/0</code> <code>CELERY_RESULT_BACKEND</code> Celery results <code>redis://127.0.0.1:6379/0</code> <code>RAZORPAY_KEY_ID</code> Razorpay key (sandbox: <code>rzp_test_*</code>) <code>rzp_test_xxxxx</code> <code>RAZORPAY_KEY_SECRET</code> Razorpay secret \u2014 <code>RAZORPAY_WEBHOOK_SECRET</code> Webhook signing secret \u2014 <code>EMAIL_BACKEND</code> Email backend <code>django.core.mail.backends.console.EmailBackend</code> (dev) <code>EMAIL_HOST</code> SMTP host <code>smtp.gmail.com</code> <code>EMAIL_PORT</code> SMTP port <code>587</code> <code>EMAIL_USE_TLS</code> Use TLS <code>True</code> <code>EMAIL_HOST_USER</code> SMTP user \u2014 <code>EMAIL_HOST_PASSWORD</code> SMTP password \u2014 <code>DEFAULT_FROM_EMAIL</code> From address <code>noreply@songlist.com</code> <code>FRONTEND_URL</code> Frontend base URL (e.g. email links) <code>http://localhost:3000</code> <code>LANGUAGE_CODE</code> Language <code>en-us</code> <code>TIME_ZONE</code> Timezone <code>Asia/Kolkata</code> <code>CELERY_TIMEZONE</code> Celery timezone <code>Asia/Kolkata</code> <code>CELERY_TASK_TIME_LIMIT</code> Task time limit (seconds) <code>1800</code> <code>RATE_LIMIT_ENABLE</code> Enable rate limiting <code>0</code> (dev) / <code>1</code> <code>RATE_LIMIT_LOGIN_ATTEMPTS</code> Max login attempts per window <code>10</code> <code>RATE_LIMIT_LOGIN_WINDOW</code> Window (seconds) <code>60</code> <p>For local development, use <code>EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend</code> to print emails to the console.</p>"},{"location":"technical/developer-setup/#local-setup","title":"Local Setup","text":""},{"location":"technical/developer-setup/#1-clone-and-install","title":"1. Clone and install","text":"<pre><code>git clone &lt;repository-url&gt;\ncd SongList-Backend\nuv sync\n</code></pre>"},{"location":"technical/developer-setup/#2-configure-environment","title":"2. Configure environment","text":"<p>Copy <code>.env.example</code> to <code>.env</code> and set at least:</p> <ul> <li><code>SECRET_KEY</code>, <code>DEBUG</code>, <code>ALLOWED_HOSTS</code></li> <li><code>DB_NAME</code>, <code>DB_USER</code>, <code>DB_PASSWORD</code>, <code>DB_HOST</code>, <code>DB_PORT</code></li> <li><code>REDIS_URL</code></li> <li><code>RAZORPAY_KEY_ID</code>, <code>RAZORPAY_KEY_SECRET</code>, <code>RAZORPAY_WEBHOOK_SECRET</code> (sandbox)</li> <li><code>EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend</code> (dev)</li> </ul>"},{"location":"technical/developer-setup/#3-database","title":"3. Database","text":"<p>Create the PostgreSQL database, then:</p> <pre><code>uv run python manage.py migrate\n</code></pre>"},{"location":"technical/developer-setup/#4-super-admin-super_admin","title":"4. Super admin (SUPER_ADMIN)","text":"<pre><code>uv run python manage.py createsuperuser\n</code></pre> <p>Use email as identifier. The created user is SUPER_ADMIN (no tenant).</p>"},{"location":"technical/developer-setup/#5-default-tenant","title":"5. Default tenant","text":"<p>Create at least one tenant (e.g. via Django shell):</p> <pre><code>uv run python manage.py shell\n</code></pre> <pre><code>from tenants.models import Tenant\nt = Tenant.objects.create(name=\"Default Tenant\", is_active=True)\nprint(t.id)  # Use for tenant-scoped auth URLs\n</code></pre>"},{"location":"technical/developer-setup/#6-run-the-server","title":"6. Run the server","text":"<pre><code>uv run python manage.py runserver\n</code></pre> <p>API base: <code>http://localhost:8000/api/v1/</code>.</p>"},{"location":"technical/developer-setup/#7-optional-redis-and-celery","title":"7. Optional: Redis and Celery","text":"<ul> <li>Redis: Ensure Redis is running (e.g. <code>redis-server</code>) for cache and Celery.</li> <li>Celery worker (payment polling, scheduled tasks):</li> </ul> <pre><code>celery -A songlist_backend worker -l info\n</code></pre> <ul> <li>Celery beat (periodic tasks):</li> </ul> <pre><code>celery -A songlist_backend beat -l info\n</code></pre>"},{"location":"technical/developer-setup/#migrations","title":"Migrations","text":"<ul> <li>Create migrations: <code>uv run python manage.py makemigrations</code></li> <li>Apply: <code>uv run python manage.py migrate</code></li> </ul>"},{"location":"technical/developer-setup/#seeding","title":"Seeding","text":"<p>Management commands live in <code>common</code>. Run from project root:</p> Command App Purpose <code>seed_genres</code> common Seed genres (run first) <code>seed_tenants</code> common Seed tenants <code>seed_songs</code> common Seed songs (requires superuser and genres) <p>Example:</p> <pre><code>uv run python manage.py seed_genres\nuv run python manage.py seed_tenants   # if using common\nuv run python manage.py seed_songs\n</code></pre> <p>Ensure tenants, users, and genres exist before <code>seed_songs</code>.</p>"},{"location":"technical/schema-design/","title":"Schema Design","text":""},{"location":"technical/schema-design/#schema-design","title":"Schema Design","text":"<p>The schema supports multi-tenancy, tenant isolation, and soft deletes. All models use UUID primary keys unless noted.</p> <p>Source: SongList Backend models. Only models present in the codebase are documented.</p> <p>On this page</p> Section Description Base and Soft-Delete BaseModel, SoftDeleteModel Enums UserRole, SongVisibility, etc. Users users table Tenants tenants table Genres genres table Songs songs table TenantSong tenant_song links Playlists playlists table PlaylistSong playlist_song SongRequest song_requests PaymentTransaction payments Subscription tenant subscriptions WebhookEvent webhook events Relationships FK summary ER Diagram Schema diagram Design Notes Deletion, constraints"},{"location":"technical/schema-design/#base-and-soft-delete","title":"Base and Soft-Delete","text":""},{"location":"technical/schema-design/#basemodel-abstract","title":"BaseModel (abstract)","text":"Field Type Description id UUID (PK) Primary key created_at DateTime Creation time updated_at DateTime Last update time"},{"location":"technical/schema-design/#softdeletemodel-abstract","title":"SoftDeleteModel (abstract)","text":"<p>Extends <code>BaseModel</code>. Adds:</p> Field Type Description deleted_at DateTime Set when soft-deleted; null otherwise deleted_by FK \u2192 User User who performed delete; optional <p><code>delete()</code> sets <code>deleted_at</code> and <code>deleted_by</code>; <code>restore()</code> clears them. <code>User</code> overrides <code>deleted_by</code> as a self-referential FK.</p>"},{"location":"technical/schema-design/#enums","title":"Enums","text":"Enum Values UserRole LISTENER, ADMIN, SUPER_ADMIN SongVisibility GLOBAL, TENANT RequestStatus PENDING, APPROVED, REJECTED, FULFILLED PaymentStatus CREATED, PENDING, PAID, VERIFIED, ACTIVATED, FAILED, REFUNDED"},{"location":"technical/schema-design/#users","title":"Users","text":"<p>Table: <code>users</code> Bases: AbstractUser, SoftDeleteModel. User defines its own <code>deleted_by</code> \u2192 self.</p> Field Type Description id UUID (PK) Primary key tenant_id FK \u2192 Tenant Null for SUPER_ADMIN; required otherwise email Email Unique per tenant; globally unique if tenant null phone_no String(15) Optional role Enum UserRole; default LISTENER is_verified Boolean Must be true to log in deleted_by FK \u2192 User Self-reference; who deleted (self or admin) deleted_at DateTime Soft delete created_at DateTime updated_at DateTime username String From AbstractUser; globally unique password String Hashed first_name String last_name String is_active Boolean date_joined DateTime <p>Constraints: Unique <code>(tenant, email)</code> when <code>tenant</code> not null; unique <code>email</code> when <code>tenant</code> null. Indexes: <code>(tenant, email)</code>, <code>(tenant, role)</code>, <code>deleted_at</code>. Soft delete: Sets <code>deleted_at</code>, <code>deleted_by</code>, <code>is_active = False</code>; soft-deletes related songs and playlists.</p>"},{"location":"technical/schema-design/#tenants","title":"Tenants","text":"<p>Table: <code>tenants</code> Base: SoftDeleteModel.</p> Field Type Description id UUID (PK) Primary key name String Unique among non-deleted is_active Boolean Default true deleted_at DateTime Soft delete deleted_by FK \u2192 User created_at DateTime updated_at DateTime <p>Constraints: Unique <code>name</code> where <code>deleted_at</code> is null. Managers: Default filters active, non-deleted; <code>all_tenants</code> includes inactive/deleted for SUPER_ADMIN.</p>"},{"location":"technical/schema-design/#genres","title":"Genres","text":"<p>Table: <code>genres</code> Base: BaseModel (no soft delete).</p> Field Type Description id UUID (PK) Primary key name String Unique description Text Optional created_at DateTime updated_at DateTime <p>Delete rule: Cannot delete if any non\u2013soft-deleted song references the genre.</p>"},{"location":"technical/schema-design/#songs","title":"Songs","text":"<p>Table: <code>songs</code> Base: SoftDeleteModel.</p> Field Type Description id UUID (PK) Primary key user_id FK \u2192 User Creator visibility Enum SongVisibility; GLOBAL or TENANT tenant_id FK \u2192 Tenant Null for GLOBAL; required for TENANT genre_id FK \u2192 Genre Required; PROTECT on delete title String artist String album String Optional duration SmallInt Seconds release_year SmallInt Validated (min year, not future) deleted_at DateTime Soft delete deleted_by FK \u2192 User created_at DateTime updated_at DateTime <p>Indexes: <code>(tenant, visibility)</code>. Validation: <code>release_year</code> between configured min and current year.</p>"},{"location":"technical/schema-design/#tenantsong","title":"TenantSong","text":"<p>Table: <code>tenant_songs</code> Base: SoftDeleteModel. Links songs to tenants.</p> Field Type Description id UUID (PK) Primary key tenant_id FK \u2192 Tenant song_id FK \u2192 Song is_active Boolean Default true deleted_at DateTime Soft delete deleted_by FK \u2192 User created_at DateTime updated_at DateTime <p>Constraints: Unique <code>(tenant, song)</code>. Indexes: <code>(tenant, song)</code>, <code>(tenant, is_active)</code>.</p>"},{"location":"technical/schema-design/#playlists","title":"Playlists","text":"<p>Table: <code>playlists</code> Base: SoftDeleteModel.</p> Field Type Description id UUID (PK) Primary key user_id FK \u2192 User Owner name String description Text Optional deleted_at DateTime Soft delete deleted_by FK \u2192 User created_at DateTime updated_at DateTime <p>Constraints: Unique <code>(user, name)</code> where <code>deleted_at</code> is null.</p>"},{"location":"technical/schema-design/#playlistsong","title":"PlaylistSong","text":"<p>Table: <code>playlist_songs</code> Base: SoftDeleteModel. Join table between Playlist and TenantSong (not Song directly).</p> Field Type Description id UUID (PK) Primary key playlist_id FK \u2192 Playlist tenant_song_id FK \u2192 TenantSong deleted_at DateTime Soft delete deleted_by FK \u2192 User created_at DateTime updated_at DateTime <p>Constraints: Unique <code>(playlist, tenant_song)</code>.</p>"},{"location":"technical/schema-design/#songrequest","title":"SongRequest","text":"<p>Table: <code>song_requests</code> Base: SoftDeleteModel.</p> Field Type Description id UUID (PK) Primary key tenant_id FK \u2192 Tenant requester_id FK \u2192 User song_title String artist_name String album_name String Optional additional_notes Text Optional status Enum RequestStatus; default PENDING reviewed_by_id FK \u2192 User Null until reviewed reviewed_at DateTime rejection_reason Text fulfilled_song_id FK \u2192 Song Null until fulfilled fulfilled_at DateTime deleted_at DateTime Soft delete deleted_by FK \u2192 User created_at DateTime updated_at DateTime <p>Constraints: Unique <code>(song_title, tenant)</code>. Indexes: <code>(tenant, status)</code>, <code>(requester, status)</code>, <code>(tenant, created_at)</code>.</p>"},{"location":"technical/schema-design/#paymenttransaction","title":"PaymentTransaction","text":"<p>Table: <code>payment_transactions</code> Base: BaseModel (no soft delete).</p> Field Type Description id UUID (PK) Primary key tenant_id FK \u2192 Tenant razorpay_payment_link_id String Unique razorpay_payment_id String Set when paid razorpay_signature String Verification payment_link_url URL From Razorpay amount Decimal currency String(3) Default INR status Enum PaymentStatus attempt_number SmallInt error_message Text metadata JSON paid_at DateTime verified_at DateTime activated_at DateTime created_at DateTime updated_at DateTime <p>Indexes: <code>(tenant, status)</code>; indexes on Razorpay IDs. State flow: CREATED \u2192 PENDING \u2192 PAID \u2192 VERIFIED \u2192 ACTIVATED (or FAILED).</p>"},{"location":"technical/schema-design/#subscription","title":"Subscription","text":"<p>Table: <code>subscriptions</code> Base: BaseModel. One-to-one per tenant; premium status stored here.</p> Field Type Description id UUID (PK) Primary key tenant_id OneToOne \u2192 Tenant is_premium Boolean Default false activated_at DateTime source String(50) e.g. razorpay payment_transaction_id FK \u2192 PaymentTransaction Nullable created_at DateTime updated_at DateTime"},{"location":"technical/schema-design/#webhookevent","title":"WebhookEvent","text":"<p>Table: <code>webhook_events</code> Base: BaseModel. Razorpay webhook log; audit and idempotency.</p> Field Type Description id UUID (PK) Primary key razorpay_event_id String Unique event_type String payload JSON signature String signature_verified Boolean processed Boolean processed_at DateTime error_message Text idempotency_key String Unique created_at DateTime updated_at DateTime"},{"location":"technical/schema-design/#relationships-summary","title":"Relationships (Summary)","text":"<ul> <li>User \u2192 Tenant (optional), deleted_by (self).  </li> <li>Tenant \u2192 users, songs, tenant_songs, song_requests, payment_transactions, subscription.  </li> <li>Song \u2192 User, Tenant (optional), Genre; tenant_songs, fulfilled_requests.  </li> <li>TenantSong \u2192 Tenant, Song; playlist_songs.  </li> <li>Playlist \u2192 User; playlist_songs.  </li> <li>PlaylistSong \u2192 Playlist, TenantSong.  </li> <li>SongRequest \u2192 Tenant, User (requester, reviewed_by), Song (fulfilled_song).  </li> <li>Genre \u2192 songs.  </li> <li>PaymentTransaction \u2192 Tenant; subscriptions.  </li> <li>Subscription \u2192 Tenant (OneToOne), PaymentTransaction.</li> </ul>"},{"location":"technical/schema-design/#er-diagram","title":"ER Diagram","text":""},{"location":"technical/schema-design/#design-notes","title":"Design Notes","text":"<ul> <li>Soft deletes: Used on users, tenants, songs, tenant_songs, playlists, playlist_songs, song_requests. <code>deleted_at</code> and <code>deleted_by</code> record when and by whom.</li> <li>Enums: Roles, visibility, request status, and payment status restrict invalid values.</li> <li>Foreign keys: Enforce referential integrity; Genre uses PROTECT to block deletes when songs exist.</li> <li>Unique constraints: Email per tenant; genre name; tenant+song; user+playlist name; playlist+tenant_song; song_request (song_title, tenant); Razorpay and idempotency identifiers.</li> </ul>"},{"location":"technical/tech-stack/","title":"Tech Stack","text":""},{"location":"technical/tech-stack/#tech-stack","title":"Tech Stack","text":"<p>Technologies used in the SongList Backend. All items below are present in the codebase or dependency configuration.</p> <p>On this page</p> Section Description Backend Django, DRF, Python Database and ORM PostgreSQL, Django ORM Authentication JWT, OTP, Redis Cache and Background Jobs Redis, Celery, Beat Payments Razorpay Storage Static, media Email SMTP Tooling and Config uv, dotenv, migrations Security and Middleware Rate limit, denylist, etc. Deployment Assumptions Processes, external services"},{"location":"technical/tech-stack/#backend","title":"Backend","text":"Technology Purpose Django Core backend framework Django REST Framework REST API Python Language (&gt;=3.13.7 per pyproject)"},{"location":"technical/tech-stack/#database-and-orm","title":"Database and ORM","text":"Technology Purpose PostgreSQL Relational database Django ORM Data access, migrations"},{"location":"technical/tech-stack/#authentication","title":"Authentication","text":"Technology Purpose djangorestframework-simplejwt JWT access and refresh tokens; blacklist after rotation pyotp OTP generation and verification (login, email verification, password reset) Token blacklist Invalidate refresh tokens (e.g. logout, rotation) Redis Cache for OTPs, email verification, access-token denylist"},{"location":"technical/tech-stack/#cache-and-background-jobs","title":"Cache and Background Jobs","text":"Technology Purpose Redis Cache backend (django-redis); Celery broker Celery Task queue (payment polling, webhook cleanup, token cleanup) Celery Beat Scheduled tasks (e.g. poll pending payments, cleanup)"},{"location":"technical/tech-stack/#payments","title":"Payments","text":"Technology Purpose Razorpay Payment gateway; payment links, webhooks, signature verification"},{"location":"technical/tech-stack/#storage","title":"Storage","text":"Technology Purpose Local / configurable Static files (<code>STATIC_ROOT</code>), media (<code>MEDIA_ROOT</code>). No dedicated object storage in default setup."},{"location":"technical/tech-stack/#email","title":"Email","text":"Technology Purpose SMTP Transactional email (verification, password reset). Backend configurable (e.g. Gmail)."},{"location":"technical/tech-stack/#tooling-and-config","title":"Tooling and Config","text":"Item Purpose uv Dependency and environment management (pyproject.toml, uv.lock) python-dotenv Environment variables from <code>.env</code> Django migrations Schema changes Logging Request/response and application logging to files"},{"location":"technical/tech-stack/#security-and-middleware","title":"Security and Middleware","text":"<ul> <li>Rate limiting: Login and auth endpoints (Django cache\u2013backed).</li> <li>Token denylist middleware: Rejects denylisted access tokens.</li> <li>Custom exception handler: JSON error responses.</li> <li>Django password validators: Default validators enabled.</li> </ul>"},{"location":"technical/tech-stack/#deployment-assumptions","title":"Deployment Assumptions","text":"<ul> <li>Processes: Django app (WSGI/ASGI), Celery worker, Celery beat.</li> <li>External services: PostgreSQL, Redis, SMTP, Razorpay (and webhook URL).</li> <li>Config: Env vars (e.g. <code>DB_*</code>, <code>REDIS_URL</code>, <code>RAZORPAY_*</code>, <code>EMAIL_*</code>).</li> </ul>"}]}